<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>درس من قصة المسمار</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        .btn-sound {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-sound:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-cyan-600 dark:text-cyan-400">الكلمات الهامة من قصة المسمار</h1>
            <p class="mt-2 text-lg text-gray-600 dark:text-gray-300">تعلم مفردات القصة ثم اختبر معلوماتك.</p>
        </header>

        <main>
            <!-- Vocabulary Section -->
            <div id="vocabulary-container" class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg mb-8">
                <h2 class="text-2xl font-bold mb-4 text-center">قائمة المفردات</h2>
                <div class="overflow-x-auto">
                    <table id="vocabulary-table" class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الكلمة/العبارة الفرنسية</th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الترجمة العربية</th>
                                <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">استمع</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                            <!-- Rows will be inserted here by JavaScript -->
                        </tbody>
                    </table>
                </div>
                 <button id="start-quiz-btn" class="mt-6 w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-500/50 transition-transform transform hover:scale-105">
                    بدء الاختبار التفاعلي
                </button>
            </div>

            <!-- Quiz Section -->
            <div id="quiz-container" class="hidden bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold mb-4 text-center">اختبار تفاعلي</h2>
                <div id="quiz-content">
                    <p id="quiz-question" class="text-xl font-semibold mb-4 text-center"></p>
                    <div id="quiz-options" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Options will be inserted here -->
                    </div>
                </div>
                <div id="quiz-feedback" class="mt-4 text-center font-bold h-6"></div>
                <div id="quiz-results" class="hidden mt-4 text-center">
                    <p class="text-2xl font-bold">النتيجة النهائية:</p>
                    <p id="score" class="text-3xl font-bold text-cyan-600 dark:text-cyan-400 my-2"></p>
                    <button id="restart-btn" class="mt-4 bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600">
                        إعادة الاختبار
                    </button>
                     <button id="back-to-words-btn" class="mt-4 bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600">
                        العودة للكلمات
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Static Vocabulary List from the story ---
            const vocabulary = [
                { french: 'mauvais caractère', arabic: 'طبع سيء' },
                { french: 'un sac de clous', arabic: 'كيس من المسامير' },
                { french: 'perdre son sang-froid', arabic: 'يفقد أعصابه' },
                { french: 'planter un clou', arabic: 'يغرس مسمارًا' },
                { french: 'la clôture', arabic: 'السياج' },
                { french: 'maîtriser sa colère', arabic: 'يتحكم في غضبه' },
                { french: 'diminua progressivement', arabic: 'تناقص تدريجيًا' },
                { french: 'retirer un clou', arabic: 'ينزع مسمارًا' },
                { french: 'les trous', arabic: 'الثقوب' },
                { french: 'une cicatrice', arabic: 'ندبة' },
                { french: 'la blessure', arabic: 'الجرح' },
                { french: 'regretter plus tard', arabic: 'يندم لاحقًا' }
            ];

            // --- DOM Elements ---
            const vocabTableBody = document.querySelector('#vocabulary-table tbody');
            const startQuizBtn = document.getElementById('start-quiz-btn');
            const vocabContainer = document.getElementById('vocabulary-container');
            const quizContainer = document.getElementById('quiz-container');
            const quizContent = document.getElementById('quiz-content');
            const quizQuestion = document.getElementById('quiz-question');
            const quizOptions = document.getElementById('quiz-options');
            const quizFeedback = document.getElementById('quiz-feedback');
            const quizResults = document.getElementById('quiz-results');
            const scoreDisplay = document.getElementById('score');
            const restartBtn = document.getElementById('restart-btn');
            const backToWordsBtn = document.getElementById('back-to-words-btn');

            // --- State ---
            let currentQuestionIndex = 0;
            let score = 0;
            let quizQuestions = [];

            // --- Functions ---

            function displayVocabulary() {
                vocabTableBody.innerHTML = '';
                vocabulary.forEach(item => {
                    const row = document.createElement('tr');
                    row.className = "hover:bg-gray-100 dark:hover:bg-gray-700";
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100" lang="fr">${item.french}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300">${item.arabic}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                            <button class="speak-btn btn-sound bg-cyan-500 hover:bg-cyan-600 text-white font-bold p-2 rounded-full" data-text="${item.french}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 5.168A1 1 0 0111 6v8a1 1 0 01-1.445.894l-4-2A1 1 0 015 12V8a1 1 0 01.555-.894l4-2z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </td>
                    `;
                    vocabTableBody.appendChild(row);
                });

                document.querySelectorAll('.speak-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const textToSpeak = e.currentTarget.getAttribute('data-text');
                        speak(textToSpeak, 'fr-FR');
                    });
                });
            }

            function speak(text, lang) {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = lang;
                    const voices = window.speechSynthesis.getVoices();
                    utterance.voice = voices.find(voice => voice.lang === lang) || voices.find(voice => voice.lang.startsWith('fr'));
                    utterance.onerror = (event) => console.error('SpeechSynthesisUtterance.onerror', event);
                    window.speechSynthesis.speak(utterance);
                } else {
                    alert('عذراً، متصفحك لا يدعم خاصية النطق.');
                }
            }
            
            if ('speechSynthesis' in window && window.speechSynthesis.getVoices().length === 0) {
                window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
            }

            function resetQuizState() {
                currentQuestionIndex = 0;
                score = 0;
                quizQuestions = [];
                quizResults.classList.add('hidden');
                quizContent.classList.remove('hidden');
                quizFeedback.textContent = '';
            }

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            function startQuiz() {
                resetQuizState();
                
                quizQuestions = shuffleArray([...vocabulary]).map(item => {
                    const otherItems = vocabulary.filter(other => other.french !== item.french);
                    const wrongAnswers = shuffleArray([...otherItems]).slice(0, 3).map(wrong => wrong.arabic);
                    const options = shuffleArray([item.arabic, ...wrongAnswers]);
                    
                    return {
                        question: `ما هي الترجمة العربية لعبارة "${item.french}"؟`,
                        options: options,
                        correctAnswer: item.arabic,
                        frenchWord: item.french
                    };
                });
                
                vocabContainer.classList.add('hidden');
                quizContainer.classList.remove('hidden');
                displayQuestion();
            }

            function displayQuestion() {
                if (currentQuestionIndex >= quizQuestions.length) {
                    showFinalScore();
                    return;
                }

                const question = quizQuestions[currentQuestionIndex];
                quizQuestion.textContent = question.question;
                quizOptions.innerHTML = '';
                quizFeedback.textContent = '';

                question.options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.className = "w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-lg hover:bg-cyan-100 dark:hover:bg-gray-700 transition";
                    button.addEventListener('click', () => handleAnswer(option, button));
                    quizOptions.appendChild(button);
                });
            }

            function handleAnswer(selectedOption, selectedButton) {
                const question = quizQuestions[currentQuestionIndex];
                const isCorrect = selectedOption === question.correctAnswer;

                Array.from(quizOptions.children).forEach(btn => {
                    btn.disabled = true;
                    if (btn.textContent === question.correctAnswer) {
                        btn.className = "w-full p-4 border-2 border-green-500 bg-green-100 dark:bg-green-900 rounded-lg text-lg";
                    }
                });

                if (isCorrect) {
                    score++;
                    selectedButton.className = "w-full p-4 border-2 border-green-500 bg-green-100 dark:bg-green-900 rounded-lg text-lg";
                    quizFeedback.textContent = "إجابة صحيحة!";
                    quizFeedback.className = 'mt-4 text-center font-bold text-green-500';
                } else {
                    selectedButton.className = "w-full p-4 border-2 border-red-500 bg-red-100 dark:bg-red-900 rounded-lg text-lg";
                    quizFeedback.textContent = `إجابة خاطئة. الصحيحة هي: ${question.correctAnswer}`;
                    quizFeedback.className = 'mt-4 text-center font-bold text-red-500';
                }
                
                speak(question.frenchWord, 'fr-FR');

                currentQuestionIndex++;
                setTimeout(displayQuestion, 2500);
            }

            function showFinalScore() {
                quizContent.classList.add('hidden');
                quizResults.classList.remove('hidden');
                scoreDisplay.textContent = `${score} / ${quizQuestions.length}`;
            }

            function returnToWords() {
                quizContainer.classList.add('hidden');
                vocabContainer.classList.remove('hidden');
            }

            // --- Event Listeners ---
            startQuizBtn.addEventListener('click', startQuiz);
            restartBtn.addEventListener('click', startQuiz);
            backToWordsBtn.addEventListener('click', returnToWords);
            
            // --- Initial Load ---
            displayVocabulary();
        });
    </script>
</body>
</html>
